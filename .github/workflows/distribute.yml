name: Distribute

on:
  workflow_dispatch:
    inputs:
      group:
        description: 'Die zu aktualisierende Gruppe. Per default werden "ALL (alle Workflows)" aktualisiert'
        type: choice
        required: true
        default: ALL
        options:
          - ALL
          - errorcodes
          - mslib
          - test

jobs:
  errorcodes:
    if: ${{ github.event.inputs.group == 'errorcodes' || github.event.inputs.group == 'ALL' }}
    runs-on: ubuntu-latest
    strategy:
      matrix:
        repository:
          - { name: md-error-codes, branch: main, group: errorcodes, workflows: "../check, build" }
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Distribute Workflows
        id: distributeWorkflows
        uses: ./.github/actions/distribute-workflows
        with:
          repositoryName: ${{ matrix.repository.name }}
          repositoryGroup: ${{ matrix.repository.group }}
          repositoryBranch: ${{ matrix.repository.branch }}
          workflows: ${{ matrix.repository.workflows }}
          awsAccessKeyId: ${{ secrets.AWS_ACCESS_KEY_ID }}
          awsSecretAccessKey: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

  mslib:
    if: ${{ github.event.inputs.group == 'mslib' || github.event.inputs.group == 'ALL' }}
    runs-on: ubuntu-latest
    strategy:
      matrix:
        repository:
          - { name: mslib-aws, branch: develop, group: mslib, workflows: "../check, build, ../encoding, postBuild" }
          - { name: mslib-rest, branch: develop, group: mslib, workflows: "../check, build, ../encoding, postBuild" }
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Distribute Workflows
        id: distributeWorkflows
        uses: ./.github/actions/distribute-workflows
        with:
          repositoryName: ${{ matrix.repository.name }}
          repositoryGroup: ${{ matrix.repository.group }}
          repositoryBranch: ${{ matrix.repository.branch }}
          workflows: ${{ matrix.repository.workflows }}
          awsAccessKeyId: ${{ secrets.AWS_ACCESS_KEY_ID }}
          awsSecretAccessKey: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

  test:
    if: ${{ github.event.inputs.group == 'test' || github.event.inputs.group == 'ALL' }}
    runs-on: ubuntu-latest
    strategy:
      matrix:
        repository:
          - { name: mcbscore-github-test-repo, branch: main, group: mslib, workflows: "../check, build, ../encoding, postBuild" }
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Distribute Workflows
        id: distributeWorkflows
        uses: ./.github/actions/distribute-workflows
        with:
          repositoryName: ${{ matrix.repository.name }}
          repositoryGroup: ${{ matrix.repository.group }}
          repositoryBranch: ${{ matrix.repository.branch }}
          workflows: ${{ matrix.repository.workflows }}
          awsAccessKeyId: ${{ secrets.AWS_ACCESS_KEY_ID }}
          awsSecretAccessKey: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
